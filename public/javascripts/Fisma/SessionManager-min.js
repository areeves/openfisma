(function(){var a={POLL_DELAY:1,COOKIE_TIMESTAMP:"session_timestamp",REFRESH_SESSION_URI:"/auth/refresh-session/format/json",_inactivityPeriod:null,_inactivityNotice:null,_timer:null,_serverTimestamp:null,_localTimestamp:null,_inactivityPanel:null,_inactivityPanelButton:null,_recentSessionRefresh:false,init:function(d,c){a._inactivityPeriod=Number(d);a._inactivityNotice=Number(c);a._serverTimestamp=YAHOO.util.Cookie.get(a.COOKIE_TIMESTAMP);a._localTimestamp=a._getLocalTimestamp();a._timer=YAHOO.lang.later(a.POLL_DELAY*1000,null,a.poll,null,true);var b=YAHOO.util.Event;b.onDOMReady(function(){b.addListener(document.body,"click",a.onActivityEvent);b.addListener(document.body,"keypress",a.onActivityEvent)})},poll:function(){var c=YAHOO.util.Cookie.get(a.COOKIE_TIMESTAMP);if(c!==a._serverTimestamp){a._serverTimestamp=c;a._localTimestamp=a._getLocalTimestamp();return}var b=a._getLocalTimestamp()-a._localTimestamp;if(b>a._inactivityPeriod){a.logout();return}if(b>a._inactivityNotice){a.notifyUser()}},notifyUser:function(){if(YAHOO.lang.isNull(a._inactivityPanel)){var d=document.createElement("div");d.innerHTML="Your session will expire soon, please click Continue to continue working.";var c=document.createElement("div");YAHOO.util.Dom.setStyle(c,"text-align","right");a._inactivityPanelButton=new YAHOO.widget.Button({type:"push",label:"Continue",container:c,onclick:{fn:a.continueSession}});d.appendChild(c);var b=new YAHOO.widget.Panel("inactivity-notice",{width:"320px",fixedcenter:true,draggable:false,modal:true,close:false});b.setHeader("Your Session Will Expire");b.setBody(d);b.render(document.body);a._inactivityPanel=b}a._inactivityPanel.show()},continueSession:function(){if(YAHOO.lang.isObject(a._inactivityPanelButton)){a._inactivityPanelButton.set("disabled",true)}var b=function(){if(YAHOO.lang.isObject(a._inactivityPanel)){a._inactivityPanel.hide()}if(YAHOO.lang.isObject(a._inactivityPanelButton)){a._inactivityPanelButton.set("disabled",false)}};YAHOO.util.Connect.asyncRequest("GET",a.REFRESH_SESSION_URI,{success:b,failure:b})},logout:function(){document.location.href="/auth/logout"},_getLocalTimestamp:function(){return Math.round((new Date()).getTime()/1000)},onActivityEvent:function(){if(YAHOO.lang.isObject(a._inactivityPanel)&&a._inactivityPanel.getProperty("visible")){return}if(a._recentSessionRefresh){return}a._recentSessionRefresh=true;a.continueSession();YAHOO.lang.later(15000,null,function(){a._recentSessionRefresh=false})}};Fisma.SessionManager=a})();