(function(){Fisma.PersistentStorage=function(a){Fisma.PersistentStorage.superclass.constructor.call(this,a)};YAHOO.extend(Fisma.PersistentStorage,Fisma.Storage,{_modified:null,get:function(a){return this._get(a)},set:function(a,b){if(this._modified===null){this._modified={}}this._modified[a]=b;return this._set(a,b)},init:function(a){for(var b in a){this._set(b,a[b])}},sync:function(d,e){var a=null,b=null,c=null;if(e){if(typeof(e)=="function"){a=e}else{if(e.success&&typeof(e.success)=="function"){a=e.success}}if(e.failure&&typeof(e.failure)=="function"){b=e.failure}if(e.scope){c=e.scope}}Fisma.Storage.onReady(function(){var g="/storage/sync/format/json",h={scope:this,success:function(i){var j=YAHOO.lang.JSON.parse(i.responseText);if(j.status=="ok"){this.init(j.data);this._modified=null}if(a){a.call(c?c:this,i,j)}},failure:function(){if(b){b.call(c?c:this)}}},f=$.param({namespace:this.namespace,updates:YAHOO.lang.JSON.stringify(this._modified),reply:d?YAHOO.lang.JSON.stringify(d):null});YAHOO.util.Connect.asyncRequest("POST",g,h,f)},this,true)}})})();