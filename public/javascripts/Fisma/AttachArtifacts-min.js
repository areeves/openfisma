Fisma.AttachArtifacts={sampleInterval:1000,apcId:null,yuiProgressBar:null,pollingTimeoutId:null,lastAsyncRequest:null,pollingEnabled:false,config:null,yuiPanel:null,showPanel:function(c,b){Fisma.AttachArtifacts.config=b;var a=new YAHOO.widget.Panel("panel",{modal:true,close:false});a.setHeader("Upload Artifact");a.setBody("Loading...");a.render(document.body);a.center();a.show();Fisma.AttachArtifacts.yuiPanel=a;YAHOO.util.Connect.asyncRequest("GET","/artifact/upload-form",{success:function(d){d.argument.setBody(d.responseText);d.argument.center()},failure:function(d){d.argument.setBody("The content for this panel could not be loaded.");d.argument.center()},argument:a},null)},trackUploadProgress:function(){var a=document.getElementById("uploadButton");uploadButton.disabled=true;var d=document.getElementById("progress_key");if(d){this.apcId=d.value;var g=document.getElementById("progressBarContainer");var b=parseInt(YAHOO.util.Dom.getStyle(g,"width"));var f=parseInt(YAHOO.util.Dom.getStyle(g,"height"));YAHOO.util.Dom.removeClass(g,"attachArtifactsProgressBar");while(g.hasChildNodes()){g.removeChild(g.firstChild)}var e=new YAHOO.widget.ProgressBar();e.set("width",b);e.set("height",f);e.set("ariaTextTemplate","Upload is {value}% complete");e.set("anim",true);var c=e.get("anim");c.duration=2;c.method=YAHOO.util.Easing.easeNone;e.render("progressBarContainer");YAHOO.util.Dom.addClass(g,"attachArtifactsProgressBar");this.yuiProgressBar=e;this.pollingEnabled=true;setTimeout(this.getProgress,this.sampleInterval,this)}document.getElementById("progressBarContainer").style.display="block";document.getElementById("progressTextContainer").style.display="block";setTimeout(this.postForm,0,this);return false},postForm:function(a){var b="/"+encodeURIComponent(a.config.server.controller)+"/"+encodeURIComponent(a.config.server.action)+"/id/"+encodeURIComponent(a.config.id)+"/format/json";YAHOO.util.Connect.setForm("uploadArtifactForm",true);YAHOO.util.Connect.asyncRequest("POST",b,{upload:a.handleUploadComplete,failure:function(c){alert("Document upload failed.")},argument:a},null)},getProgress:function(a){if(a.pollingEnabled){a.lastAsyncRequest=YAHOO.util.Connect.asyncRequest("GET","/artifact/upload-progress/format/json/id/"+a.apcId,{success:function(c){var b=YAHOO.lang.JSON.parse(c.responseText);var d=Math.round((b.progress.current/b.progress.total)*100);a.yuiProgressBar.set("value",d);var e=document.getElementById("progressTextContainer").firstChild;e.nodeValue=d+"%";a.pollingTimeoutId=setTimeout(a.getProgress,a.sampleInterval,a)}},null)}},handleUploadComplete:function(c){var d=c.argument;var b=YAHOO.lang.JSON.parse(c.responseText);if(!b.success){alert(b.message)}d.pollingEnabled=false;clearTimeout(d.pollingTimeoutId);YAHOO.util.Connect.abort(d.lastAsyncRequest);if(d.yuiProgressBar){d.yuiProgressBar.get("anim").duration=0.5;d.yuiProgressBar.set("value",100)}document.getElementById("progressTextContainer").firstChild.textValue="Verifying file.";var e=Fisma[d.config.callback.object];if(typeof e!="Undefined"){var a=e[d.config.callback.method];if(typeof a=="function"){a.call(e,d.yuiPanel)}}}};