Fisma.AttachArtifacts={sampleInterval:1000,apcId:null,yuiProgressBar:null,pollingTimeoutId:null,lastAsyncRequest:null,pollingEnabled:false,config:null,yuiPanel:null,showPanel:function(c,b){Fisma.AttachArtifacts.config=b;var a=new YAHOO.widget.Panel("panel",{modal:true,close:false});a.setHeader("Upload Artifact");a.setBody("Loading...");a.render(document.body);a.center();a.show();Fisma.AttachArtifacts.yuiPanel=a;YAHOO.util.Connect.asyncRequest("GET","/artifact/upload-form",{success:function(d){d.argument.setBody(d.responseText);d.argument.center()},failure:function(d){d.argument.setBody("The content for this panel could not be loaded.");d.argument.center()},argument:a},null)},trackUploadProgress:function(){var b=document.getElementById("uploadButton");b.disabled=true;var f=this;var d=document.getElementById("progress_key");if(d){this.apcId=d.value;var h=document.getElementById("progressBarContainer");var a=parseInt(YAHOO.util.Dom.getStyle(h,"width"));var g=parseInt(YAHOO.util.Dom.getStyle(h,"height"));YAHOO.util.Dom.removeClass(h,"attachArtifactsProgressBar");while(h.hasChildNodes()){h.removeChild(h.firstChild)}var e=new YAHOO.widget.ProgressBar();e.set("width",a);e.set("height",g);e.set("ariaTextTemplate","Upload is {value}% complete");e.set("anim",true);var c=e.get("anim");c.duration=2;c.method=YAHOO.util.Easing.easeNone;e.render("progressBarContainer");YAHOO.util.Dom.addClass(h,"attachArtifactsProgressBar");this.yuiProgressBar=e;this.pollingEnabled=true;setTimeout(function(){f.getProgress(f)},this.sampleInterval)}document.getElementById("progressBarContainer").style.display="block";document.getElementById("progressTextContainer").style.display="block";setTimeout(function(){f.postForm(f)},0);return false},postForm:function(a){var b="/"+encodeURIComponent(a.config.server.controller)+"/"+encodeURIComponent(a.config.server.action)+"/id/"+encodeURIComponent(a.config.id)+"/format/json";YAHOO.util.Connect.setForm("uploadArtifactForm",true);YAHOO.util.Connect.asyncRequest("POST",b,{upload:a.handleUploadComplete,failure:function(c){alert("Document upload failed.")},argument:a},null)},getProgress:function(a){if(a.pollingEnabled){a.lastAsyncRequest=YAHOO.util.Connect.asyncRequest("GET","/artifact/upload-progress/format/json/id/"+a.apcId,{success:function(c){var b=YAHOO.lang.JSON.parse(c.responseText);var d=Math.round((b.progress.current/b.progress.total)*100);a.yuiProgressBar.set("value",d);var e=document.getElementById("progressTextContainer").firstChild;e.nodeValue=d+"%";a.pollingTimeoutId=setTimeout(a.getProgress,a.sampleInterval,a)}},null)}},handleUploadComplete:function(c){var d=c.argument;var b=YAHOO.lang.JSON.parse(c.responseText);if(!b.success){alert(b.message)}d.pollingEnabled=false;clearTimeout(d.pollingTimeoutId);YAHOO.util.Connect.abort(d.lastAsyncRequest);if(d.yuiProgressBar){d.yuiProgressBar.get("anim").duration=0.5;d.yuiProgressBar.set("value",100)}var f=document.getElementById("progressTextContainer").firstChild;f.nodeValue="Verifying file.";var e=Fisma[d.config.callback.object];if(typeof e!="Undefined"){var a=e[d.config.callback.method];if(typeof a=="function"){a.call(e,d.yuiPanel)}}}};