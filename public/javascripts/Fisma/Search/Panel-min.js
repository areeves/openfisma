Fisma.Search.Panel=function(f){var h;var b=f;if(0===b.length){throw"Field array cannot be empty"}b.sort(function(l,i){if(l.label<i.label){return -1}else{if(l.label>i.label){return 1}else{return 0}}});this.searchableFields=[];for(h in b){var c=b[h];if(c.hidden!==true){this.searchableFields[this.searchableFields.length]=c}}this.defaultQueryTokens=null;var a=document.location.search.substring(1);var d=a.split("&");for(var g in d){var k=d[g];var e=k.split("=");if("q"==e[0]){var j=e[1];this.defaultQueryTokens=j.split("/");if(this.defaultQueryTokens[0]===""){this.defaultQueryTokens.splice(0,1)}}else{if("show"===e[0]){this.showAll="all"===e[1]}}}};Fisma.Search.Panel.prototype={container:null,criteria:[],showAll:false,render:function(l){this.container=l;var b=YAHOO.util.Dom;var c=YAHOO.lang;var g=Fisma.Search.QueryState;var s=new g(b.get("modelName").value);var p,d,u;if(this.showAll){u=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(u);this.container.appendChild(u.render(this.searchableFields[0].name))}else{if(this.defaultQueryTokens){var f=0;while(this.defaultQueryTokens.length>f){var a=this.defaultQueryTokens[f];f++;var h=this.defaultQueryTokens[f];f++;var m=this.getFieldDefinition(a);var q=new Fisma.Search.Criteria(this,this.searchableFields);var j=q.getCriteriaDefinition(m);var k=this.getNumberOfOperands(m,h,j);var e=[];for(;k>0;k--){e.push(this.defaultQueryTokens[f]);f++}var t=$P.array_map(decodeURIComponent,e);var r=q.render(a,h,t);this.container.appendChild(q.container);this.criteria.push(q)}Fisma.Search.toggleAdvancedSearchPanel();c.later(null,null,function(){Fisma.Search.updateQueryState(s,b.get("searchForm"))})}else{if(s.getSearchType()===g.TYPE_ADVANCED){var o=s.getAdvancedQuery();for(p in o){d=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(d);this.container.appendChild(d.render(o[p].field,o[p].operator,o[p].operands))}Fisma.Search.toggleAdvancedSearchPanel()}else{if(Fisma.Search.searchPreferences.type==="advanced"){var n=Fisma.Search.searchPreferences.fields;for(p in n){d=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(d);this.container.appendChild(d.render(p,n[p]))}Fisma.Search.toggleAdvancedSearchPanel()}else{u=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(u);this.container.appendChild(u.render(this.searchableFields[0].name))}}}}if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(false)}Fisma.Search.onSetTable(function(){var i=document.getElementById("searchForm");setTimeout(function(){Fisma.Search.executeSearch(i)},1)})},addCriteria:function(b){if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(true)}if(!this.searchableFields[this.criteria.length]){throw"No field defined for search"}var d=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(d);var a=this.criteria.length-1;var c=d.render(this.searchableFields[a].name);this.container.insertBefore(c,b.nextSibling)},removeCriteria:function(b){for(var a in this.criteria){var c=this.criteria[a];if(c.container==b){this.criteria.splice(a,1);break}}if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(false)}this.container.removeChild(b)},getQuery:function(){var c=new Array();for(var a in this.criteria){var b=this.criteria[a];if(b.hasBlankOperands()){continue}c.push(b.getQuery())}return c},getPanelState:function(){var c=new Array();for(var a in this.criteria){var b=this.criteria[a];c.push(b.getQuery())}return c},getFieldDefinition:function(b){for(var a in this.searchableFields){if(this.searchableFields[a].name==b){return this.searchableFields[a]}}throw"No definition for field: "+b},getNumberOfOperands:function(e,b,d){var a=d[b];if(!a){throw"No criteria defined for field ("+e.name+") and operator ("+b+")"}var c=a.query;switch(c){case"noInputs":return 0;break;case"enumSelect":case"oneInput":return 1;break;case"twoInputs":return 2;break;default:throw"Number of operands not defined for query function: "+c;break}throw"Number of operands not defined for query function: "+c}};