Fisma.Email=function(){return{panelElement:null,showRecipientDialog:function(){YAHOO.util.Dom.get("msgbar").style.display="none";if(Fisma.Email.panelElement!==null&&Fisma.Email.panelElement instanceof YAHOO.widget.Panel){Fisma.Email.panelElement.removeMask();Fisma.Email.panelElement.destroy();Fisma.Email.panelElement=null}var c=document.createElement("div");var g=document.createElement("p");var b=document.createTextNode("* Target E-mail Address:");g.appendChild(b);c.appendChild(g);var e=document.createElement("input");e.id="testEmailRecipient";e.name="recipient";c.appendChild(e);var f=document.createElement("div");f.style.height="10px";c.appendChild(f);var a=document.createElement("input");a.type="button";a.id="dialogRecipientSendBtn";a.style.marginLeft="10px";a.value="Send";c.appendChild(a);var d={width:"260px",modal:false};Fisma.Email.panelElement=Fisma.HtmlPanel.showPanel("Test E-mail Configuration",c.innerHTML,null,d);document.getElementById("dialogRecipientSendBtn").onclick=Fisma.Email.sendTestEmail},sendTestEmail:function(){if(document.getElementById("testEmailRecipient").value===""){alert("Recipient is required.");document.getElementById("testEmailRecipient").focus();return false}var c=document.getElementById("testEmailRecipient").value;var b=document.getElementById("email_config");b.elements.recipient.value=c;var a=document.getElementById("sendTestEmail");spinner=new Fisma.Spinner(a.parentNode);spinner.show();YAHOO.util.Connect.setForm(b);YAHOO.util.Connect.asyncRequest("POST","/config/test-email-config/format/json",{success:function(e){var d=YAHOO.lang.JSON.parse(e.responseText);message(d.msg,d.type,true);spinner.hide()},failure:function(d){alert("Failed to send test mail: "+d.statusText);spinner.hide()}},null);if(Fisma.Email.panelElement!==null&&Fisma.Email.panelElement instanceof YAHOO.widget.Panel){Fisma.Email.panelElement.hide();Fisma.Email.panelElement.destroy();Fisma.Email.panelElement=null}return true}}}();