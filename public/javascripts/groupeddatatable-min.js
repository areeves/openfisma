(function(){var b=YAHOO.util.Dom,a=YAHOO.util.Event,g=YAHOO.util,e=YAHOO.widget,d=YAHOO.lang,f=YAHOO.widget.DataTable;var c=function(m,l,h,k){if(!k.groupBy){return new YAHOO.widget.DataTable(m,l,h,k)}this._groupBy=k.groupBy;this.MSG_NOGROUP=k.MSG_NOGROUP?k.MSG_NOGROUP:"(none)";this._oldFormatRow=k.formatRow;k.formatRow=this.rowFormatter;c.superclass.constructor.call(this,m,l,h,k);if(k.autoRender!==true&&k.autoRender!==false){k.autoRender=true}if(k.autoRender===true){this.initGroups()}this.subscribe("sortedByChange",function(n){this.initGroups(n)});this.subscribe("rowClickEvent",function(n){this.unselectGroup(n)});var i=YAHOO.util.Dom.get(m);var j=YAHOO.util.Dom.getChildrenBy(i,function(n){return n.tagName=="TABLE"});j[0].dataTable=this};e.GroupedDataTable=c;d.extend(c,f,{currentGroupName:null,groups:[],resetGroups:true,onGroupClick:new YAHOO.util.CustomEvent("onGroupClick",this),selectedGroup:null,rowFormatter:function(i,h){if(this.resetGroups){this.groups=[];this.currentGroupName=null;this.resetGroups=false}var j=h.getData(this._groupBy);if(j!==this.currentGroupName){this.groups.push({name:j,row:i,record:h,group:null});b.addClass(i,"group-first-row")}this.currentGroupName=j;return true},initGroups:function(){if(!this.resetGroups){for(var h=0;h<this.groups.length;h++){this.groups[h].group=this.insertGroup(this.groups[h].name,this.groups[h].row)}this.resetGroups=true}},insertGroup:function(i,q,k){var j=this.getRecordIndex(q);var o=document.createElement("tr");var l=document.createElement("td");var p=this.getColumnSet().keys.length;var m=document.createElement("div");if(k!=true&&k!=false){k=true}o.className="group group-collapsed";l.colSpan=p;if(b.hasClass(q,"yui-dt-first")){b.removeClass(q,"yui-dt-first");b.addClass(o,"group-first")}var h=document.createElement("div");h.className="liner";m.className="icon";h.appendChild(m);var n=document.createElement("div");n.innerHTML=i?this.visibleGroupName(i):this.MSG_NOGROUP;n.className="label";h.appendChild(n);l.appendChild(h);o.appendChild(l);if(k){b.insertBefore(o,q)}else{b.insertAfter(o,q)}a.addListener(m,"click",this.toggleVisibility,this);if(i.length>0){a.addListener(o,"mouseover",this.onGroupMouseover,this);a.addListener(o,"mouseout",this.onGroupMouseout,this);a.addListener(o,"mousedown",this.onGroupMousedown,this);a.addListener(o,"mouseup",this.onGroupMouseup,this);a.addListener(o,"click",this.onGroupClick,this);a.addListener(o,"dblclick",this.onGroupDblclick,this)}else{b.addClass(o,"group-disabled")}this.fireEvent("insertGroupEvent",{group:o});var q=b.getNextSibling(o);while(q&&!b.hasClass(q,"group")&&!b.hasClass(q,"group-collapsed")){q.style.display="none";q=b.getNextSibling(q)}return o},onEventSelectGroup:function(h){this.selectGroup(h)},selectGroup:function(j){var n=j.target;var l=this.getTrEl(n);if(!this.selectedGroup||l!==this.selectedGroup){this.unselectGroup(j);b.addClass(l,"group-selected");this.selectedGroup=l;var m=this.getSelectedTrEls();for(var k=0;k<m.length;k++){this.unselectRow(m[k])}var h=this.getGroupRecord(l);this.fireEvent("groupSelectEvent",{record:h,el:l})}},unselectGroup:function(i){var j=i.target;var k=this.getTrEl(j);if(this.selectedGroup&&k!==this.selectedGroup){b.removeClass(this.selectedGroup,"group-selected");var h=this.getGroupRecord(this.selectedGroup);this.fireEvent("groupUnselectEvent",{record:h,el:this.selectedGroup});this.selectedGroup=null}},toggleVisibility:function(k,h){var j=b.getAncestorByClassName(a.getTarget(k),"group");var i;if(b.hasClass(j,"group-expanded")){i=false;b.replaceClass(j,"group-expanded","group-collapsed");h.fireEvent("groupCollapseEvent",{target:j,event:k})}else{i=true;b.replaceClass(j,"group-collapsed","group-expanded");h.fireEvent("groupExpandEvent",{target:j,event:k})}var l=b.getNextSibling(j);while(l&&!b.hasClass(l,"group")&&!b.hasClass(l,"group-collapsed")){if(i){l.style.display=""}else{l.style.display="none"}l=b.getNextSibling(l)}},getGroupRecord:function(j){for(var h=0;h<this.groups.length;h++){if(this.groups[h].group===j){return this.groups[h].record}}},getPreviousTrEl:function(k){var i=k;var h=c.superclass.getPreviousTrEl.call(this,i);var j=this.getFirstTrEl();if(h==j){return null}while(h!==j){if(b.hasClass(h,"group")){h=c.superclass.getPreviousTrEl.call(this,h)}else{return h}}return i},getNextTrEl:function(j){var h=c.superclass.getNextTrEl.call(this,j);var i=this.getLastTrEl();while(h!==i){if(b.hasClass(h,"group")){h=c.superclass.getNextTrEl.call(this,h)}else{return h}}return i},isGroup:function(h){return b.hasClass(h,"group")},groupRowsAboveRecord:function(l){var j;if(d.isNumber(l)){if(l>=this.getRecordSet().getLength()){l=this.getRecordSet().getLength()-1}j=this.getRecordSet().getRecords()[l].getId();if(b.get(j)==null){if(this.getRecordSet().getRecords()[l-1]){j=this.getRecordSet().getRecords()[l-1].getId()}else{return 0}}}else{j=l}var h=c.superclass.getTrEl.call(this,j);var k=0;while(h!=null){if(b.hasClass(h,"group")){k++}h=c.superclass.getPreviousTrEl.call(this,h)}return k},groupForTableIndex:function(i){var h=YAHOO.widget.GroupedDataTable.superclass.getTrEl.call(this,i);while(h!=null){if(b.hasClass(h,"group")){return this.groupName(h)}h=YAHOO.widget.GroupedDataTable.superclass.getPreviousTrEl.call(this,h)}return null},groupName:function(i){var h=b.getElementBy(function(j){return b.hasClass(j,"label")},null,i);return h?h.innerHTML:null},visibleGroupName:function(h){return h},getTRForGroup:function(j){var i=this;var h=b.getFirstChildBy(this.getTbodyEl(),function(k){return i.isGroup(k)&&i.groupName(k)===j});return h},getDataTableFromId:function(j){var h=b.get(j);var i=b.getAncestorByTagName(h,"TABLE");return i.dataTable},onGroupMouseover:function(i,h){h.fireEvent("groupMouseoverEvent",{target:a.getTarget(i),event:i})},onGroupMouseout:function(i,h){h.fireEvent("groupMouseoutEvent",{target:a.getTarget(i),event:i})},onGroupMousedown:function(i,h){h.fireEvent("groupMousedownEvent",{target:a.getTarget(i),event:i})},onGroupMouseup:function(i,h){h.fireEvent("groupMouseupEvent",{target:a.getTarget(i),event:i})},onGroupClick:function(i,h){h.fireEvent("groupClickEvent",{target:a.getTarget(i),event:i})},onGroupDblclick:function(i,h){h.fireEvent("groupDblclickEvent",{target:a.getTarget(i),event:i})},onGroupSelect:function(i,h){h.fireEvent("groupSelectEvent",{target:a.getTarget(i),event:i})}})})();